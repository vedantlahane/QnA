{% extends 'base.html' %}
{% block title %}Upload Files - AI Document Assistant{% endblock %}
{% block content %}
<div class="mx-auto max-w-5xl px-4 py-6">
  <h1 class="text-2xl font-semibold mb-2">Upload your documents</h1>
  <p class="text-gray-600 mb-6">Supports PDF, CSV, and SQL/SQLite databases up to 50MB.</p>

  <div class="rounded-2xl border bg-white/70 p-4 mb-6">
    <form method="post" enctype="multipart/form-data" class="space-y-3">
      {% csrf_token %}
      {{ form.non_field_errors }}
      <div>
        {{ form.file }}
        {% for err in form.file.errors %}<p class="text-sm text-red-600">{{ err }}</p>{% endfor %}
      </div>
      <button class="rounded-xl bg-blue-600 text-white px-4 py-2 hover:bg-blue-700">Upload & Process</button>
    </form>
  </div>

  <div class="rounded-2xl border bg-white/70 p-4">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-medium">Your Files</h2>
      <form method="get" class="flex gap-2">
        {{ search_form.search_query }}
        {{ search_form.file_type }}
        {{ search_form.status }}
        <button class="rounded-xl border px-3 py-2 text-sm">Filter</button>
      </form>
    </div>
    {% if uploaded_files %}
      <ul class="divide-y">
        {% for file in uploaded_files %}
          <li class="py-3 flex items-center justify-between">
            <div class="min-w-0">
              <div class="font-medium truncate">{{ file.original_filename }}</div>
              <div class="text-xs text-gray-500">{{ file.uploaded_at|date:"M d, Y" }} • {{ file.file_type|upper }} • {{ file.get_file_size_display }}</div>
            </div>
            <div class="flex items-center gap-2">
              <span class="text-xs rounded-full border px-2 py-1">{{ file.status|title }}</span>
              <form method="post" action="{% url 'qna_app:delete_file' file.file_id %}">
                {% csrf_token %}
                <button class="text-red-600 text-sm hover:underline">Delete</button>
              </form>
            </div>
          </li>
        {% endfor %}
      </ul>

      <div class="mt-4">
        {% if uploaded_files.has_previous %}
          <a class="text-sm hover:underline" href="?page={{ uploaded_files.previous_page_number }}">Previous</a>
        {% endif %}
        <span class="text-sm mx-2">Page {{ uploaded_files.number }} of {{ uploaded_files.paginator.num_pages }}</span>
        {% if uploaded_files.has_next %}
          <a class="text-sm hover:underline" href="?page={{ uploaded_files.next_page_number }}">Next</a>
        {% endif %}
      </div>
    {% else %}
      <div class="text-sm text-gray-500">No files uploaded yet</div>
    {% endif %}
  </div>
</div>
{% endblock %}
